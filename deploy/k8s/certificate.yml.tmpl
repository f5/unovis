{{- if .vis_ssl_static }}
{{- else }}
{{- if and .vis_host .vis_ssl }}
apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: {{ .vis_host }}
  namespace: {{ if .vis_namespace }}{{ .vis_namespace }}{{ else }}{{ if .namespace }}{{ .namespace }}{{ else }}vis{{ end }}{{ end }}
spec:
  secretName: {{ .vis_host }}-tls
  commonName: {{ .vis_host }}
  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer
  dnsNames: &names
    - {{ .vis_host }}
  acme:
    config:
      - http01:
          ingressClass: nginx
        domains: *names
{{- end }}
{{- end }}
