import { moduleMetadata, componentWrapperDecorator } from "@storybook/angular";
import { Meta, Story, ArgsTable } from "@storybook/addon-docs";
import { Scale } from "@volterra/vis";
import { VisXYContainerModule } from "src/public-api";

import { VisXYContainerComponent } from "src/containers/xy-container/xy-container.component";
import { XYContainerStory } from "./xy-container.component";
import {
  baseConfig,
  defaultArgs,
  flatConfig,
  skewedConfig,
  specialConfig,
} from "./xy-container.config";

<Meta
  title="XY Charts/Container"
  component={VisXYContainerComponent}
  decorators={[
    moduleMetadata({
      declarations: [XYContainerStory],
      imports: [VisXYContainerModule],
    }),
    componentWrapperDecorator(XYContainerStory, defaultArgs),
  ]}
/>

<style>{``}</style>

# XY Container

### Basic configuration

The XYContainer is designed as a wrapper to hold other `vis` elements. Here is an example of a common configuration:
an `xy-chart` alongside two `axis` components:

```angular2html
<vis-xy-container [data]="data">
  <vis-stacked-bar [x]="x" [y]="y"></vis-stacked-bar>
  <vis-axis type="x"></vis-axis>
  <vis-axis type="y"></vis-axis>
</vis-xy-container>
```

<Story name="Basic Container">
  {{
    props: {
      ...baseConfig(),
    },
  }}
</Story>

### Margin

You can change the container's margins using the `margin` property, which accepts an object with the properties `top`, `bottom`, `left`, and `right`
and corresponding pixel values. This determines the distance between the XY container and other elements on the page. Notice what happens when each margin is set to 100px and there is another element on the page.

```angular2html
// Component file
containerMargin = { top: 100; bottom: 100; left: 100; right: 100 }

// Template file
<vis-xy-container ... [margin]="containerMargin"></vis-xy-container>
```

<Story name="Custom Margin">
  {{
    props: {
      ...baseConfig(),
      margin: { top: 100, bottom: 100, left: 100, right: 100 },
      sideElement: true,
    },
  }}
</Story>

### Padding

Similarly, to provide `padding` with the same object type to change the container's padding (i.e. the space between the inner components).

```angular2html
// Component file
containerPadding = { top: 100; bottom: 100; left: 100; right: 100 }

// Template file
<vis-xy-container ... [padding]="containerPadding"></vis-xy-container>
```

<Story name="Custom Padding">
  {{
    props: {
      ...baseConfig(),
      padding: { top: 100, bottom: 100, left: 100, right: 100 },
    },
  }}
</Story>

### xRange and yRange

Changing the range of screen space occupied by each dimension of your data using the `xRange` and `yRange` properties.
It accepts type `[number, number]` where the elements represent the starting and ending positions, respectively.

#### xRange

Provide xRange with values `[xStart, width]`. More specifically, `xStart` is the offset relative to the starting position
of the data.

```angular2html
<vis-xy-container ... [xRange]="[10, 500]"></vis-xy-container>
```

<Story name="xRange">
  {{
    props: {
      ...baseConfig(),
      xRange: [10, 500],
    },
  }}
</Story>

#### yRange

Note that yRange's configuration is the opposite. Provide yRange with `[height, yStart]`. `yStart` is the offset position.

```angular2html
<vis-xy-container ... [yRange]="[150, 50]"></vis-xy-container>
```

<Story name="yRange">
  {{
    props: {
      ...baseConfig(),
      yRange: [150, 50],
    },
  }}
</Story>

### xDomain and yDomain

You can change the domain of your data with the `xDomain` and `yDomain` properties to configure which values your `xy-chart` should display.
The result will show all data that is in this range- excluding any values that fall outside of the range, and occupying any missing values with white space.

#### xDomain

Consider the following example where the actual data contains values for all x values such that `0 <= x <= 50`.

```angular2html
<vis-xy-container ... [xDomain]="[25, 55]"></vis-xy-container>
```

<Story name="xDomain">
  {{
    props: {
      ...specialConfig(),
      xDomain: [25, 55],
    },
  }}
</Story>

#### yDomain

The following example has data which contains values for all y values such that `0 <= y <= 50`.

```angular2html
<vis-xy-container ... [xDomain]="[25, 55]"></vis-xy-container>
```

<Story name="yDomain">
  {{
    props: {
      ...specialConfig(),
      yDomain: [5, 75],
    },
  }}
</Story>

### Domain Constraints

Customizing your domain is helpful in datasets with outliers. When using dynamic data, you may not know which values to constrain your domain values to.
With the following constraint properties `xDomainMinConstraint`, `xDomainMaxConstraint`, `yDomainMinConstraint`, and `yDomainMaxConstraint`,
you can define partial domains. For the following examples, consider the following case where the majority of the data is within
the ranges `{0 <= n <= 50}` for all values of x and y.

<Story name="Domain Constraints: Undefined">
  {{
    props: {
      ...flatConfig(),
    },
  }}
</Story>

These properties accept a number array in the form `[number, number]` or more typically `[number, undefined] | [undefined, number]`.

#### xDomainMinConstraint

```angular2html
<vis-xy-container ... [xDomainMinConstraint]="[0, undefined]"></vis-xy-container>
```

<Story name="xDomainMinConstraint">
  {{
    props: {
      ...flatConfig(),
      xDomainMinConstraint: [0, undefined],
    },
  }}
</Story>

#### yDomainMinConstraint

```angular2html
<vis-xy-container ... [yDomainMinConstraint]="[0, undefined]"></vis-xy-container>
```

<Story name="yDomainMinConstraint">
  {{
    props: {
      ...flatConfig(),
      yDomainMinConstraint: [0, undefined],
    },
  }}
</Story>

#### xDomainMaxConstraint

```angular2html
<vis-xy-container ... [xDomainMaxConstraint]="[0, 50]",></vis-xy-container>
```

<Story name="xDomainMaxConstraint">
  {{
    props: {
      ...flatConfig(),
      xDomainMaxConstraint: [0, 50],
    },
  }}
</Story>

#### yDomainMaxConstraint

```angular2html
<vis-xy-container ... [yDomainMaxConstraint]="[0,50]",></vis-xy-container>
```

<Story name="Domain: Max Constraints">
  {{
    props: {
      ...flatConfig(),
      yDomainMaxConstraint: [undefined, 50],
    },
  }}
</Story>

### xScale and yScale

To change the scale of one of your axes, use the `xScale` or `yScale` property and a `Scale` function (i.e. `Scale.scaleLinear()`).
Currently, only continuous scales are supported:

`scaleLinear`, `scalePow`, `scaleSqrt`, `scaleLog`, `scaleTime`, `scaleUtc`

See [d3-scale](https://github.com/d3/d3-scale) for more information about the meaning behind these functions.

#### xScale

See an example of a simple `y = x` line with an xScale property set to `Scale.scaleSqrt()`

```javascript
// Component file
import { Scale } from '@volterra/vis'
altScale = Scale.scaleSqrt()

// Template file
<vis-xy-container ... [xScale]="altScale"></vis-xy-container>
```

<Story name="xScale">
  {{
    props: {
      ...skewedConfig(),
      xScale: Scale.scaleSqrt(),
    },
  }}
</Story>

#### yScale

See an example of a simple `y = x` line with an yScale property set to `Scale.scaleLog()`

```javascript
// Component file
import { Scale } from '@volterra/vis'
logScale = Scale.scaleSqrt()

// Template file
<vis-xy-container ... [yScale]="logScale"></vis-xy-container>
```

<Story name="yScale">
  {{
    props: {
      ...skewedConfig(),
      yScale: Scale.scaleLog(),
      storyHeight: 400,
    },
  }}
</Story>

### Scale by Domain

You can also set the yScale domain based on X's, rather than customizing

<Story name="Scale by Domain">
  {{
    props: {
      ...baseConfig(),
      data: Array(10)
        .fill(0)
        .map((_, i) => ({ x: i, y: i * 10 })),
      scaleByDomain: [0, 1],
    },
  }}
</Story>

<ArgsTable of={VisXYContainerComponent} />
