import { moduleMetadata, componentWrapperDecorator } from '@storybook/angular'
import { Meta, Story, ArgsTable } from '@storybook/addon-docs'
import { VisTooltipModule } from 'src/public-api'
import { VisTooltipComponent } from 'src/components/tooltip/tooltip.component'
import { barTooltipConfig,  lineTooltipConfig, multiTooltipConfig, scatterTooltipConfig } from './tooltip.config'
import { TooltipExampleComponent } from './tooltip.component.ts'

<Meta
  title="XY Charts/Tooltip"
  component={VisTooltipComponent}
  decorators={[
    moduleMetadata({ declarations: [TooltipExampleComponent], imports: [VisTooltipModule] }),
    componentWrapperDecorator(TooltipExampleComponent),
  ]}
/>

<style>{``}</style>

# Tooltip
### Base Configuration
The Tooltip component has been designed to work alongside XY charts. The minimal Tooltip configuration looks like:
```angular2html
<vis-xy-container>
  <vis-xy-chart ... ></vis-xy-chart>
  <vis-tooltip [triggers]="triggers"></vis-tooltip>
</vis-xy-container>
```
where `triggers` maps a selector to a HTML element to display on hover.

### More on Triggers
Triggers define the content of the tooltip when a given selector is hovered over. See below where a StackedBar selector
triggers a simple `<p>` element:

#### Single Trigger Example
```javascript
/// In the component file
const triggers: {
    [StackedBar.selectors.bar]: (d: DataRecord) => `<p>x: ${d.x}</p><p>y: ${d.y}</p>`,
},

// In the template
<vis-xy-container [data]="data">
  <vis-stacked-bar .... ></vis-stacked-bar>
  <vis-tooltip [triggers]="triggers"></vis-tooltip>
</vis-xy-container>
```
<Story name="Simple Tooltip">
  {{
    props: {
      ...barTooltipConfig(),
    }
  }}
</Story>

#### Multi Trigger Example
A Tooltip can have multiple triggers. Consider the following example, which displays different content depending whether the `Line` or
`Bar` is being hovered over:

```javascript
/// In the component file
const triggers: {
    [StackedBar.selectors.bar]: tooltipElementFn,
    [Line.selectors.line]: d => `<p>Target</p>`,
},

// In the template
<vis-xy-container [data]="data">
  <vis-stacked-bar .... ></vis-stacked-bar>
  <vis-line .... ></vis-line>
  <vis-tooltip [triggers]="triggers"></vis-tooltip>
</vis-xy-container>
```
where `tooltipElementFn` is a function that returns a `HTMLElement` to display based on the provided `DataRecord`.

<Story name="Triggers">
  {{
    props: {
      ...multiTooltipConfig(),
    }
  }}
</Story>

### Tooltip Position
To control where the tooltip appears relative to the selector, you can use placement and shifting properties.

### Horizontal and Vertical Placement
The `horizontalPlacement` and `verticalPlacement` properties accept a `Position` enum type or string equivalent. In the case of
overflow, the Tooltip will ignore the position argument in order to remain in the bounds of the chart.

#### horizontalPlacement
```angular2html
<vis-tooltip ... horizontalPlacement="left"></vis-tooltip>
```
<Story name="Horizontal Placement">
  {{
    props: {
      ...scatterTooltipConfig(),
      horizontalPlacement: 'left',
    }
  }}
</Story>

#### verticalPlacement
```angular2html
<vis-tooltip ... verticalPlacement="top"</vis-tooltip>
```
<Story name="Vertical Placement">
  {{
    props: {
      ...scatterTooltipConfig(),
      verticalPlacement: 'top',
    }
  }}
</Story>

### Horizontal and Vertical shifting
You can also supply the Tooltip component with `horizontalShift` or `verticalShift` with a number to increase the distance (in pixels) between
the selector and tooltip.
#### horizontalShift
```angular2html
<vis-tooltip ... horizontalShift="100"></vis-tooltip>
```
<Story name="Horizontal Shift">
  {{
    props: {
      ...scatterTooltipConfig(),
      horizontalShift: 100,
    }
  }}
</Story>

#### verticalShift
```angular2html
<vis-tooltip ... horizontalShift="100"></vis-tooltip>
```
<Story name="Vertical Shift">
  {{ props: {
    ...scatterTooltipConfig(),
    verticalShift: 100,
  }}}
</Story>

### Position Strategy
You can set the position of the tooltip to `absolute` or `fixed` to change how the tooltip adjusts its position during scrolling.
<Story name="Position Strategy">
  {{
    props: {
      ...barTooltipConfig(),
      positionStrategy: 'fixed',
    }
  }}
</Story>

### Container
You can manually set the container for the Tooltip to be placed in using the `container` property.

```angular2html
/// In the component file
const container = document.getElementById('tooltipContainer')

// In the template
<vis-tooltip [container]="container"></vis-tooltip>
</vis-xy-container>
```
where `tooltipContainer` is a valid `HTMLElement`.

<Story name="Container">
  {{
    props: {
      ...barTooltipConfig(),
      container: document.createElement('div'),
    }
  }}
</Story>

### Components
Similarly, you can manually define the components the tooltip interacts with using the `components` property.

```angular2html
/// In the component file
const components: [new Scatter<T>(...), new Line<T>(...)]

// In the template
<vis-tooltip [components]="components"></vis-tooltip>
```

<Story name="Components">
  {{
    props: {
      components: lineTooltipConfig().components.concat(scatterTooltipConfig().components),
      triggers: {...lineTooltipConfig().triggers, ...scatterTooltipConfig().triggers },
    }
  }}
</Story>

### Controlling the tooltip via the `component` property.
You can manually define the behavior of your Tooltip from within your angular component by calling the `place`, `show`, and `hide` functions
on the `VisTooltip`'s component property. The method definitions are as follows:

`hide(): void`<br/>
`place(pos: {x: ..., y: ...})`<br/>
`show(content: HTMLElement | string, pos: {x: ..., y: ...}): void`<br/>

See the following simple example, where the tooltip is manually toggled as a button's callback.

```angular2html
/// In the container component
@ViewChild(VisTooltipComponent) tooltipRef: VisTooltipComponent<DataRecord>
showTooltip() {
  this.tooltipRef.component?.show('<p>Custom Tooltip</p>', {x: 150, y: 150})
}

hideTooltip() {
  this.tooltipRef.hide()
}

// In the template
<button (click)="showTooltip()">Show Tooltip</button>
<button (click)="hideTooltip()()">Hide Tooltip</button>
...
<vis-tooltip ... ></vis-tooltip>
```
<Story name="Custom Behavior">
  {{
    props: {
      ...scatterTooltipConfig(),
      triggers: undefined,
    }
  }}
</Story>

### Component Inputs
<ArgsTable of={VisTooltipComponent} />
