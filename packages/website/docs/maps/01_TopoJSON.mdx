---
sidebar_position: 1
title: TopoJSON Map
sidebar_label: TopoJSON Map
---

import BrowserOnly from '@docusaurus/BrowserOnly'
import CodeBlock from '@theme/CodeBlock'
import { PropTable } from '../components/props-table.tsx'
import { DocWrapper, InputWrapper } from '../wrappers'
import { data, generatePointData, generateLinkData } from './data'
import cities from './data/cities_big.json'
import areas from './data/areas.json'

export const defaultProps = () => ({
  name: "TopoJSONMap",
  configKey: "component",
  containerName: "SingleContainer",
  visImports: ["WorldMapTopoJSON"],
  topojson: "WorldMapTopoJSON",
  height: 400,
  dataType: "MapPoint, MapLink, MapArea",
})

export const pointData = {
  points: generatePointData()
}

### Basic Configuration
The _TopoJSONMap_ is a map that uses [TopoJSON](https://github.com/topojson/topojson) as its underlying data. The basic configuration is:
<DocWrapper {...defaultProps()} topojson="WorldMapTopoJSON" showContext="container"/>

Currently the following TopoJSONs available to import directly from `@volterra/vis`: `WorldMapTopoJSON`, `WorldMapSimplestTopoJSON`, and `WorldMap110mAlphaTopoJSON`.

### Map Data
There are three main building blocks that can make up the data supplied to _TopoJSONMap_:
* **point**, a geographical coordinate
* **link**, a graph edge that connects two _points_
* **area**, a geographical area

The container for _TopoJSONMap_ accepts data in the form of an `Object` with these three building blocks as keys mapped to their data arrays, like so:

```ts
type MapData = {
  area: MapArea[];
  points: MapPoint[];
  links: MapLink[];
}
```

<DocWrapper {...defaultProps()}  data={data} showContext="full"/>

where `MapArea`, `MapPoint`, and `MapLink` are custom types that that represent map data. Keep reading to learn more about the minimum configurations for these types.

### Points
A minimum viable datatype of the objects provided to the `points` attribute is:

```ts
type MapPoint = {
  latitude: NumericAccessor;
  longitute: NumericAccessor;
}
```
Or, you can simply provide these values through the `latitude` and `longitute` properties of your _TopoJSONMap_ directly.

<DocWrapper {...defaultProps()} topojson="WorldMapTopoJSON" dataType="MapPoint,undefined,undefined" data={pointData} showContext="container"/>

### mapFitToPoints
<DocWrapper {...defaultProps()}
  data={pointData}
  mapFitToPoints={true}/>

### Point Customization
The following _TopoJSONMap_ properties accept accessor functions to customize the appearance of your points:
* `pointColor`
* `pointCursor`
* `pointRadius`
* `pointStrokeWidth`

### Point Labels
You can provide labels with the `pointLabel` attribute, which accepts a `StringAccessor` function to be called on each `MapPoint` datum.
<DocWrapper {...defaultProps()} data={pointData} dataType="MapPoint,undefined,undefined" pointLabel={d => d.city} showContext="minimal"/>

### Custom Point Labels
The following _TopoJSONMap_ properties can further customize your Point Label.
* `pointLabelPosition`
* `pointLabelTextBrighnessRatio`

### Example: Custom Points
export const customData = ({
  points: data.points.map(d => ({
    ...d,
    serverName: `server-${d.city.substring(0,1)}${Math.floor(Math.random() * 10)}`,
    userCount: Math.floor(Math.random() * 100),
    threatLevel: Math.floor(Math.random() * 4)
  }))
});
export const colorLegendItems = [
  { name: 'Safe', color: 'green' },
  { name: 'Mild', color: 'yellow' },
  { name: 'Moderate', color: 'orange'},
  { name: 'Severe', color: 'red' }
]

<BrowserOnly>
{() => {
  const { TopoJSONMap } = require('@volterra/vis')
  return (
    <DocWrapper
      {...defaultProps()}
      data={customData}
      mapFitToPoints={true}
      pointLabel={d => d.serverName}
      pointRadius={d => d.userCount / 10}
      pointColor={d => ['green', 'yellow', 'orange', 'red'][d.threatLevel]}
      showContext="minimal"
      dataType="MapPoint,undefined,undefined"
      componentProps={[
        {name: "BulletLegend", props: { items: colorLegendItems }, key: 'components'},
        {
          name: "Tooltip",
          key: "tooltip",
          props: {
            triggers: {
              [TopoJSONMap.selectors.pointCircle]: d => `Users: ${d.userCount}`
            }
          }
        }
      ]}/>
  )
}}
</BrowserOnly>

### Links
A minimum viable data type of the objects provided to the `links` attribute contains the keys `source` and `target`, which correspond
to the points the link will connect. Most commonly, the `pointId`

```ts
type MapLink = {
  source: string | number | MapPoint;
  target: string | number | MapPoint;
}
```
Or, you can simply provide these values through the `linkSource` and `linkTarget` properties.

<DocWrapper {...defaultProps()} topojson="WorldMapTopoJSON" dataType="MapPoint,MapLink,undefined"  data={{...data, areas: [] }} showContext="container"/>

#### Link customization
You can further customize the map _Links_ with the following properties:
* `linkColor`
* `linkCursor`
* `linkWidth`

### Areas
To work with features in the __TopoJSONMap_, all you need is a unique `id` which is defined in the chart's _topojson_ definition.
For example, in our `WorldMapTopoJSON` _topojson_, ever country has a unique id that corresponds to the
[ISO 3166-1 alpha-2](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2) country code.
```ts
type MapArea = {
  id: string;
}
```
<DocWrapper {...defaultProps()} data={{
  areas: data.areas
}} dataType="MapArea,undefined,undefined" pointId={d => d.id} topojson="WorldMapTopoJSON" showContext="minimal"/>

#### Area customization
You can further customize the map _Area_ with the following properties:
* `areaColor`
* `areaCursor`

### Projection
You can provide a projection for your _TopoJSONMap_ with a `MapProjection` instance. See D3's [geo projections](https://github.com/d3/d3-geo) for more information.

<BrowserOnly>
{() => {
  const { MapProjectionKind } = require('@volterra/vis')
  return (
  <InputWrapper {...defaultProps()}
    inputType="select"
    property="projection"
    visImports={["WorldMapTopoJSON", "MapProjection"]}
    defaultValue={'MapProjection.Mercator()'}
    options={Object.values(MapProjectionKind)}
    inputProps={{onChange: e => `MapProjection.${e}()`}}
    showContext="minimal"/>
  )}}
</BrowserOnly>

### Zoom
By default, zooming is enabled for a _TopoJSONMap_ component. You can disable it by setting the `disableZoom` property to `true`.

For further customization, you can configure the following zoom properties:

### - zoomFactor
To set the initial zoom factor.

### - zoomExtent
`zoomExtent` represents the range `[a,b]` which your map can zoom in and out, where `[a, b]` are the minimum and maximum zoom factors, respectively.

<DocWrapper {...defaultProps()} zoomFactor={5} zoomExtent={[1,5]}/>

### - zoomDuration
`zoomDuration` is the duration of the animation on when zooming in on your _TopoJSONMap_ with _VisControls_.

### Heatmap Mode
For datasets with a lot of points, you can enable `heatmapMode`
<DocWrapper {...defaultProps()} data={{ points: cities}} heatmapMode={true}/>

You can customize the appearance of your heat map blur with the `heatmapModeBlurStdDeviation` property.

### heatmapModeZoomLevelThreshold
To lower or raise the threshold hat will disable the blur effect of your heat map, use the the `heatmapModeZoomLevelThreshold` property.
You can provide a zoom level, (i.e. `2` for _2x_ zoom), that once reached, that will no longer display the blur effect.

### Additional Styling: CSS Variables
The _TopoJSONMap_ component supports additional styling via CSS variables that you can define for your visualization container.

<details open>
  <summary>All supported CSS variables</summary>
  <CodeBlock language="css">
{`--vis-map-feature-color
--vis-map-boundary-color
--vis-map-point-label-text-color-dark
--vis-map-point-label-text-color-light
--vis-map-point-label-font-family
--vis-map-point-label-font-weight
--vis-map-point-label-font-size
`}
  </CodeBlock>
</details>


### Component Props
<PropTable name="VisTopoJSONMap"/>
